<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ candidate.name }} - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
            direction: rtl;
            text-align: right;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        
        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .nav-links a:hover {
            color: #667eea;
        }
        
        .nav-links button:hover {
            color: #667eea !important;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 15px;
        }
        
        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .dashboard-header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card h3 {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .stat-card p {
            color: #666;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 0;
            overflow-x: auto;
        }
        
        .tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab:hover {
            color: #667eea;
            background: #f8f9fa;
        }
        
        .tab-content {
            background: white;
            padding: 2rem;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .card h2 {
            color: #667eea;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .file-input {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background: #667eea;
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            transition: background 0.3s ease;
            min-width: 200px;
            text-align: center;
        }
        
        .file-input label {
            cursor: pointer;
            display: block;
            margin: 0;
        }
        
        .file-input:hover {
            background: #5a6fd8;
        }
        
        .file-input input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .btn {
            background: #667eea;
            color: white;
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .preview-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .preview-section h3 {
            color: #667eea;
            margin-bottom: 1rem;
        }
        
        .preview-link {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 0.8rem 1.5rem;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        
        .preview-link:hover {
            background: #218838;
        }
        
        .social-media-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .current-image {
            max-width: 150px;
            max-height: 150px;
            border-radius: 8px;
            margin-top: 0.5rem;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            overflow-x: auto;
            display: block;
            white-space: nowrap;
        }
        
        .data-table thead,
        .data-table tbody,
        .data-table tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.8rem;
            text-align: right;
            border-bottom: 1px solid #e9ecef;
            word-wrap: break-word;
            white-space: normal;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #667eea;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .data-table td:first-child,
        .data-table th:first-child {
            width: 25%;
        }
        
        .data-table td:nth-child(2),
        .data-table th:nth-child(2) {
            width: 15%;
        }
        
        .data-table td:nth-child(3),
        .data-table th:nth-child(3) {
            width: 15%;
        }
        
        .data-table td:nth-child(4),
        .data-table th:nth-child(4) {
            width: 15%;
        }
        
        .data-table td:nth-child(5),
        .data-table th:nth-child(5) {
            width: 15%;
        }
        
        .data-table td:last-child,
        .data-table th:last-child {
            width: 15%;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .options-list {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            background: #f8f9fa;
        }
        
        .option-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .option-item input {
            flex: 1;
        }
        
        .add-option-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .add-option-btn:hover {
            background: #218838;
        }
        
        .remove-option-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.3rem 0.6rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .remove-option-btn:hover {
            background: #c82333;
        }
        
        @media (max-width: 768px) {
            .social-media-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-links {
                display: none;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <div class="logo">ğŸ—³ï¸ Election 360</div>
            <ul class="nav-links">
                <li><a href="/hub/candidate/{{ candidate.id }}/" target="_blank">Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</a></li>
                <!-- <li><a href="/hub/election-dashboard/">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li> -->
                <li>
                    <form method="post" action="/accounts/logout/" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="next" value="/login/">
                        <button type="submit" style="background: none; border: none; color: #333; font-weight: 500; cursor: pointer; text-decoration: none; transition: color 0.3s ease; padding: 0;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                    </form>
                </li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="dashboard-header">
            <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… {{ candidate.name }}</h1>
            <p>Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ ÙˆÙ…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨ÙŠØ©</p>
        </div>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success">{{ message }}</div>
            {% endfor %}
        {% endif %}

        <div class="stats-grid">
            <div class="stat-card">
                <h3>{{ supporters_count }}</h3>
                <p>Ø§Ù„Ù…Ø¤ÙŠØ¯ÙˆÙ†</p>
            </div>
            <div class="stat-card">
                <h3>{{ events|length }}</h3>
                <p>Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</p>
            </div>
            <div class="stat-card">
                <h3>{{ speeches|length }}</h3>
                <p>Ø§Ù„Ø®Ø·Ø§Ø¨Ø§Øª</p>
            </div>
            <div class="stat-card">
                <h3>{{ polls|length }}</h3>
                <p>Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª</p>
            </div>
        </div>
        <!-- Edit Event Modal -->
        <div id="editEventModal" class="modal" style="display:none; position: fixed; inset:0; background: rgba(0,0,0,0.5); z-index: 4000;">
            <div class="modal-content" style="background:#fff; max-width: 720px; width: calc(100% - 32px); margin: 40px auto; padding: 20px; border-radius: 12px; position: relative; max-height: 80vh; overflow-y: auto;">
                <span class="modal-close" onclick="closeEditEventModal()" style="position:absolute; top:10px; left:12px; font-size: 24px; cursor: pointer;">&times;</span>
                <h3 style="margin-top:0;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</h3>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update_event">
                    <input type="hidden" id="ee_id" name="event_id">
                    <div class="form-group"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input id="ee_title" name="event_title"></div>
                    <div class="form-group"><label>Ø§Ù„ÙˆØµÙ</label><textarea id="ee_desc" name="event_description"></textarea></div>
                    <div class="form-group"><label>Ø§Ù„Ù†ÙˆØ¹</label>
                        <select id="ee_type" name="event_type">
                            <option value="meeting">Ø§Ø¬ØªÙ…Ø§Ø¹</option>
                            <option value="conference">Ù…Ø¤ØªÙ…Ø±</option>
                            <option value="rally">ØªØ¬Ù…Ø¹</option>
                            <option value="debate">Ù…Ù†Ø§Ø¸Ø±Ø©</option>
                            <option value="announcement">Ø¥Ø¹Ù„Ø§Ù†</option>
                            <option value="other">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    <div class="form-group"><label>Ø§Ù„Ù…ÙˆÙ‚Ø¹</label><input id="ee_loc" name="event_location"></div>
                    <div class="form-group"><label>Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label><input type="datetime-local" id="ee_start" name="event_start_datetime"></div>
                    <div class="form-group"><label>Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label><input type="datetime-local" id="ee_end" name="event_end_datetime"></div>
                    <div class="form-group"><label><input type="checkbox" id="ee_public" name="event_is_public"> Ø¹Ø§Ù…Ø©</label></div>
                    <div class="form-group"><label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰</label><input id="ee_max" name="event_max_attendees" type="number" min="1"></div>
                    <div class="form-group"><label>ØµÙˆØ±Ø©</label><input id="ee_img" name="event_image" type="file" accept="image/*"></div>
                    <div style="display:flex; gap:10px;">
                        <button type="submit" class="btn btn-success">Ø­ÙØ¸</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditEventModal()">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Speech Modal -->
        <div id="editSpeechModal" class="modal" style="display:none; position: fixed; inset:0; background: rgba(0,0,0,0.5); z-index: 4000;">
            <div class="modal-content" style="background:#fff; max-width: 720px; width: calc(100% - 32px); margin: 40px auto; padding: 20px; border-radius: 12px; position: relative; max-height: 80vh; overflow-y: auto;">
                <span class="modal-close" onclick="closeEditSpeechModal()" style="position:absolute; top:10px; left:12px; font-size: 24px; cursor: pointer;">&times;</span>
                <h3 style="margin-top:0;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ø·Ø§Ø¨</h3>
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update_speech">
                    <input type="hidden" id="es_id" name="speech_id">
                    <div class="form-group"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input id="es_title" name="speech_title"></div>
                    <div class="form-group"><label>Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label><textarea id="es_content" name="speech_content" rows="8"></textarea></div>
                    <div class="form-group"><label>Ø§Ù„Ù…Ù„Ø®Øµ</label><textarea id="es_summary" name="speech_summary" rows="3"></textarea></div>
                    <div style="display:flex; gap:10px;">
                        <button type="submit" class="btn btn-success">Ø­ÙØ¸</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditSpeechModal()">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="preview-section">
            <h3>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
            <p>Ø´Ø§Ù‡Ø¯ ÙƒÙŠÙ ØªØ¨Ø¯Ùˆ ØµÙØ­ØªÙƒ Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù†Ø§Ø®Ø¨ÙŠÙ†:</p>
            <a href="/hub/candidate/{{ candidate.id }}/" target="_blank" class="preview-link">Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</a>
        </div>

        {% if candidate.bot %}
        <div class="preview-section">
            <h3>ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ· Ù„Ù„Ø¨ÙˆØª</h3>
            <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡Ø¨ÙˆØ· Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ø­Ù…Ù„ØªÙƒ:</p>
            <a href="{% if candidate.bot and candidate.bot.token %}/hub/landing/token/{{ candidate.bot.token }}/{% else %}/hub/landing/{{ candidate.bot.id }}/{% endif %}" target="_blank" class="preview-link">ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ· Ù„Ù„Ø¨ÙˆØª</a>
        </div>
        {% endif %}

        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab active" onclick="showTab(event, 'profile')">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
            <button class="tab" onclick="showTab(event, 'events')">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</button>
            <button class="tab" onclick="showTab(event, 'speeches')">Ø§Ù„Ø®Ø·Ø§Ø¨Ø§Øª</button>
            <button class="tab" onclick="showTab(event, 'polls')">Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª</button>
            <button class="tab" onclick="showTab(event, 'gallery')">Ø§Ù„Ù…Ø¹Ø±Ø¶</button>
            <button class="tab" onclick="showTab(event, 'testimonials')">Ø§Ù„Ø¢Ø±Ø§Ø¡</button>
            <button class="tab" onclick="showTab(event, 'supporters')">Ø§Ù„Ø¯Ø§Ø¹Ù…ÙŠÙ†</button>
            <button class="tab" onclick="showTab(event, 'benefits')">Ø§Ù„Ù…Ø²Ø§ÙŠØ§</button>
            <button class="tab" onclick="showTab(event, 'questions')">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
        </div>

        <!-- Profile Tab -->
        <div id="profile" class="tab-content active">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}" style="background: #d4edda; color: #155724; padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
            
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="action" value="profile">
                
                <div class="card">
                    <h2>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
                    
                    <div class="form-group">
                        <label for="name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" id="name" name="name" value="{{ candidate.name }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="position">Ø§Ù„Ù…Ù†ØµØ¨</label>
                        <input type="text" id="position" name="position" value="{{ candidate.position }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="party">Ø§Ù„Ø­Ø²Ø¨ Ø§Ù„Ø³ÙŠØ§Ø³ÙŠ</label>
                        <input type="text" id="party" name="party" value="{{ candidate.party|default:'' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="email" name="email" value="{{ candidate.email|default:'' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="tel" id="phone" name="phone" value="{{ candidate.phone|default:'' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="website">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="url" id="website" name="website" value="{{ candidate.website|default:'' }}">
                    </div>
                </div>

                <div class="card">
                    <h2>Ø§Ù„ØµÙˆØ± Ø§Ù„Ø´Ø®ØµÙŠØ©</h2>
                    
                    <div class="form-group">
                        <label>Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                        {% if candidate.profile_image %}
                            <img src="{{ candidate.profile_image.url }}" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©" class="current-image">
                        {% else %}
                            <p>Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©</p>
                        {% endif %}
                        <div class="file-input">
                            <input type="file" name="profile_image" accept="image/*" id="profile_image_input">
                            <label for="profile_image_input">ğŸ“· Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                        {% if candidate.logo %}
                            <img src="{{ candidate.logo.url }}" alt="Ø§Ù„Ø´Ø¹Ø§Ø±" class="current-image">
                        {% else %}
                            <p>Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ø´Ø¹Ø§Ø±</p>
                        {% endif %}
                        <div class="file-input">
                            <input type="file" name="logo" accept="image/*" id="logo_input">
                            <label for="logo_input">ğŸ·ï¸ Ø§Ø®ØªØ± Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯</label>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Ø­ÙˆÙ„ ÙˆØ§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</h2>
                    
                    <div class="form-group">
                        <label for="bio">Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</label>
                        <textarea id="bio" name="bio" placeholder="Ø£Ø®Ø¨Ø± Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ† Ø¹Ù† Ù†ÙØ³ÙƒØŒ Ø®Ù„ÙÙŠØªÙƒØŒ ÙˆÙ„Ù…Ø§Ø°Ø§ ØªØ±Ø´Ø­ Ù†ÙØ³Ùƒ...">{{ candidate.bio|default:'' }}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="program">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨ÙŠ</label>
                        <textarea id="program" name="program" placeholder="Ø§ÙˆØµÙ Ù…Ù†ØµØªÙƒØŒ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŒ ÙˆÙ…Ø§ ØªØ®Ø·Ø· Ù„ØªØ­Ù‚ÙŠÙ‚Ù‡...">{{ candidate.program|default:'' }}</textarea>
                    </div>
                </div>

                <div class="card">
                    <h2>ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</h2>
                    
                    <div class="social-media-grid">
                        <div class="form-group">
                            <label for="facebook">Ø±Ø§Ø¨Ø· ÙÙŠØ³Ø¨ÙˆÙƒ</label>
                            <input type="url" id="facebook" name="facebook" value="{{ candidate.social_media.facebook|default:'' }}" placeholder="https://facebook.com/yourpage">
                        </div>
                        
                        <div class="form-group">
                            <label for="twitter">Ø±Ø§Ø¨Ø· ØªÙˆÙŠØªØ±</label>
                            <input type="url" id="twitter" name="twitter" value="{{ candidate.social_media.twitter|default:'' }}" placeholder="https://twitter.com/yourhandle">
                        </div>
                        
                        <div class="form-group">
                            <label for="instagram">Ø±Ø§Ø¨Ø· Ø¥Ù†Ø³ØªØºØ±Ø§Ù…</label>
                            <input type="url" id="instagram" name="instagram" value="{{ candidate.social_media.instagram|default:'' }}" placeholder="https://instagram.com/yourhandle">
                        </div>
                        
                        <div class="form-group">
                            <label for="linkedin">Ø±Ø§Ø¨Ø· Ù„ÙŠÙ†ÙƒØ¯ Ø¥Ù†</label>
                            <input type="url" id="linkedin" name="linkedin" value="{{ candidate.social_media.linkedin|default:'' }}" placeholder="https://linkedin.com/in/yourprofile">
                        </div>
                        
                        <div class="form-group">
                            <label for="youtube">Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨</label>
                            <input type="url" id="youtube" name="youtube" value="{{ candidate.social_media.youtube|default:'' }}" placeholder="https://youtube.com/@channel">
                        </div>
                        
                        <div class="form-group">
                            <label for="tiktok">Ø±Ø§Ø¨Ø· ØªÙŠÙƒ ØªÙˆÙƒ</label>
                            <input type="url" id="tiktok" name="tiktok" value="{{ candidate.social_media.tiktok|default:'' }}" placeholder="https://tiktok.com/@handle">
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button type="submit" class="btn">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                </div>
            </form>
        </div>

        <!-- Questions Tab -->
        <div id="questions" class="tab-content">
            <div class="card">
                <div style="display:flex;align-items:center;justify-content:space-between; margin-bottom: 1rem;">
                    <h2>Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±</h2>
                    {% if questions %}
                    <button class="btn" onclick="exportQuestionsPDF()">ØªØµØ¯ÙŠØ± PDF</button>
                    {% endif %}
                </div>
                {% if questions %}
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„Ø³Ø¤Ø§Ù„</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for q in questions %}
                            <tr data-q-id="{{ q.id }}" data-q-text="{{ q.question|escape }}" data-q-name="{{ q.bot_user.first_name }} {{ q.bot_user.last_name }}" data-q-date="{{ q.asked_at|date:'Y-m-d H:i' }}" data-q-answer="{{ q.answer|default:''|escape }}">
                                <td>{{ q.asked_at|date:"Y-m-d H:i" }}</td>
                                <td>{{ q.bot_user.first_name }} {{ q.bot_user.last_name }}</td>
                                <td style="white-space: pre-wrap; overflow:hidden; text-overflow: ellipsis; max-width: 320px;">{{ q.question }}</td>
                                <td style="white-space: pre-wrap; color:#2f855a;">{{ q.answer|default:'â€”' }}</td>
                                <td>{% if q.is_answered %}<span style="color:#28a745;">Ù…Ø¬Ø§Ø¨</span>{% else %}<span style="color:#dc3545;">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</span>{% endif %}</td>
                                <td><button type="button" class="btn" onclick="openQuestionModal(this)">Ø¹Ø±Ø¶</button></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p style="color:#888;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>
                {% endif %}
            </div>
        </div>

        <!-- Question Modal -->
        <div id="questionModal" class="modal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 3000;">
            <div class="modal-content" style="background:#fff; max-width: 680px; width: calc(100% - 32px); margin: 40px auto; padding: 20px; border-radius: 12px; position: relative;">
                <span class="modal-close" onclick="closeQuestionModal()" style="position:absolute; top:10px; left:12px; font-size: 24px; cursor: pointer;">&times;</span>
                <h3 id="qmTitle" style="margin-top:0;">Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±</h3>
                <div id="qmMeta" style="color:#666; font-size: 0.9rem; margin-bottom: 10px;"></div>
                <div id="qmText" style="white-space: pre-wrap; background:#f8f9fa; padding: 12px; border-radius: 8px; border:1px solid #e9ecef; margin-bottom: 14px;"></div>
                <form method="post" onsubmit="return submitQuestionAnswer(event)">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="answer_question">
                    <input type="hidden" id="qmId" name="question_id">
                    <div class="form-group">
                        <label for="qmAnswer">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</label>
                        <textarea id="qmAnswer" name="answer" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                    </div>
                    <div style="display:flex; gap: 10px;">
                        <button type="submit" class="btn btn-success">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
                        <button type="button" class="btn btn-secondary" onclick="closeQuestionModal()">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- Events Tab -->
        <div id="events" class="tab-content">
            <div class="card">
                <h2>Ø¥Ø¶Ø§ÙØ© ÙØ¹Ø§Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="add_event">
                    
                    <div class="form-group">
                        <label for="event_title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</label>
                        <input type="text" id="event_title" name="event_title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="event_description">ÙˆØµÙ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</label>
                        <textarea id="event_description" name="event_description" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="event_type">Ù†ÙˆØ¹ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</label>
                        <select id="event_type" name="event_type">
                            <option value="meeting">Ø§Ø¬ØªÙ…Ø§Ø¹</option>
                            <option value="conference">Ù…Ø¤ØªÙ…Ø±</option>
                            <option value="rally">ØªØ¬Ù…Ø¹</option>
                            <option value="debate">Ù…Ù†Ø§Ø¸Ø±Ø©</option>
                            <option value="announcement">Ø¥Ø¹Ù„Ø§Ù†</option>
                            <option value="other">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="event_location">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                        <input type="text" id="event_location" name="event_location" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="event_start_datetime">ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                        <input type="datetime-local" id="event_start_datetime" name="event_start_datetime" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="event_end_datetime">ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="datetime-local" id="event_end_datetime" name="event_end_datetime">
                    </div>
                    
                    <div class="form-group">
                        <label for="event_max_attendees">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø­Ø¶ÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="number" id="event_max_attendees" name="event_max_attendees" min="1">
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="event_is_public" name="event_is_public" checked>
                            <label for="event_is_public">ÙØ¹Ø§Ù„ÙŠØ© Ø¹Ø§Ù…Ø©</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ØµÙˆØ±Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</label>
                        <div class="file-input">
                            <input type="file" name="event_image" accept="image/*">
                            Ø±ÙØ¹ ØµÙˆØ±Ø© Ù„Ù„ÙØ¹Ø§Ù„ÙŠØ©
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</button>
                </form>
            </div>

            <div class="card">
                <h2>Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                {% if events %}
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                                <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                                <th>Ø¹Ø§Ù…Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for event in events %}
                            <tr>
                                <td>{{ event.title }}</td>
                                <td>{{ event.get_event_type_display }}</td>
                                <td>{{ event.start_datetime|date:"Y-m-d H:i" }}</td>
                                <td>{{ event.location }}</td>
                                <td>
                                    {% if event.image %}
                                        <img src="{{ event.image.url }}" alt="ØµÙˆØ±Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©" style="width: 64px; height: 48px; object-fit: cover; border-radius: 6px; border:1px solid #e9ecef;">
                                    {% else %}
                                        â€”
                                    {% endif %}
                                </td>
                                <td>{{ event.is_public|yesno:"Ù†Ø¹Ù…,Ù„Ø§" }}</td>
                                <td>
                                    <div style="display:flex; gap:6px;">
                                        <button type="button" class="btn" style="background:#64748b; padding: 0.3rem 0.8rem; font-size: 0.8rem;" onclick="openEditEventModal('{{ event.id }}','{{ event.title|escapejs }}','{{ event.description|escapejs }}','{{ event.event_type }}','{{ event.location|escapejs }}','{{ event.start_datetime|date:'Y-m-d\TH:i' }}','{{ event.end_datetime|default:''|date:'Y-m-d\TH:i' }}', '{{ event.is_public|yesno:'1,0' }}', '{{ event.max_attendees|default:'' }}')">ØªØ¹Ø¯ÙŠÙ„</button>
                                        <form method="post" style="display: inline;" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©ØŸ')">
                                            {% csrf_token %}
                                            <input type="hidden" name="action" value="delete_event">
                                            <input type="hidden" name="event_id" value="{{ event.id }}">
                                            <button type="submit" class="btn btn-danger" style="padding: 0.3rem 0.8rem; font-size: 0.8rem;">Ø­Ø°Ù</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                {% endif %}
            </div>
        </div>

        <!-- Speeches Tab -->
        <div id="speeches" class="tab-content">
            <div class="card">
                <h2>Ø¥Ø¶Ø§ÙØ© Ø®Ø·Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="add_speech">
                    
                    <div class="form-group">
                        <label for="speech_title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø·Ø§Ø¨</label>
                        <input type="text" id="speech_title" name="speech_title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="speech_content">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø·Ø§Ø¨</label>
                        <textarea id="speech_content" name="speech_content" rows="10" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="speech_summary">Ù…Ù„Ø®Øµ Ø§Ù„Ø®Ø·Ø§Ø¨</label>
                        <textarea id="speech_summary" name="speech_summary" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="speech_type">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø§Ø¨</label>
                        <select id="speech_type" name="speech_type">
                            <option value="campaign">Ø­Ù…Ù„Ø© Ø§Ù†ØªØ®Ø§Ø¨ÙŠØ©</option>
                            <option value="policy">Ø³ÙŠØ§Ø³Ø©</option>
                            <option value="rally">ØªØ¬Ù…Ø¹</option>
                            <option value="debate">Ù…Ù†Ø§Ø¸Ø±Ø©</option>
                            <option value="other">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    
                    <!-- <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="speech_ai_generated" name="speech_ai_generated">
                            <label for="speech_ai_generated">Ù…ÙˆÙ„Ø¯ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</label>
                        </div>
                    </div> -->
                    
                    <button type="submit" class="btn btn-success">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø·Ø§Ø¨</button>
                </form>
            </div>

            <div class="card">
                <h2>Ø§Ù„Ø®Ø·Ø§Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                {% if speeches %}
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù…Ù„Ø®Øµ</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for speech in speeches %}
                            <tr>
                                <td>{{ speech.title }}</td>
                                <td>{{ speech.get_speech_type_display }}</td>
                                <td>{{ speech.created_at|date:"Y-m-d" }}</td>
                                <td>{{ speech.summary|truncatewords:10 }}</td>
                                <td>
                                    <div style="display:flex; gap:6px;">
                                        <button type="button" class="btn" style="background:#64748b; padding: 0.3rem 0.8rem; font-size: 0.8rem;" onclick="openEditSpeechModal('{{ speech.id }}','{{ speech.title|escapejs }}','{{ speech.full_speech|escapejs }}','{{ speech.summary|escapejs }}')">ØªØ¹Ø¯ÙŠÙ„</button>
                                        <form method="post" style="display: inline;" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø®Ø·Ø§Ø¨ØŸ')">
                                            {% csrf_token %}
                                            <input type="hidden" name="action" value="delete_speech">
                                            <input type="hidden" name="speech_id" value="{{ speech.id }}">
                                            <button type="submit" class="btn btn-danger" style="padding: 0.3rem 0.8rem; font-size: 0.8rem;">Ø­Ø°Ù</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø§Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                {% endif %}
            </div>
        </div>

        <!-- Polls Tab -->
        <div id="polls" class="tab-content">
            <div class="card">
                <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¬Ø¯ÙŠØ¯</h2>
                <form method="post" id="poll-form">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="add_poll">
                    
                    <div class="form-group">
                        <label for="poll_question">Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹</label>
                        <input type="text" id="poll_question" name="poll_question" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹</label>
                        <div class="options-list" id="poll-options">
                            <div class="option-item">
                                <input type="text" name="poll_options" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„" required>
                                <button type="button" class="remove-option-btn" onclick="removeOption(this)" style="display: none;">Ø­Ø°Ù</button>
                            </div>
                            <div class="option-item">
                                <input type="text" name="poll_options" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ" required>
                                <button type="button" class="remove-option-btn" onclick="removeOption(this)">Ø­Ø°Ù</button>
                            </div>
                        </div>
                        <button type="button" class="add-option-btn" onclick="addOption()">Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±</button>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="poll_is_anonymous" name="poll_is_anonymous" checked>
                            <label for="poll_is_anonymous">Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù…Ø¬Ù‡ÙˆÙ„</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="poll_allows_multiple" name="poll_allows_multiple">
                            <label for="poll_allows_multiple">Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="poll_expires_at">ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="datetime-local" id="poll_expires_at" name="poll_expires_at">
                    </div>
                    
                    <button type="submit" class="btn btn-success">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹</button>
                </form>
            </div>

            <div class="card">
                <h2>Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                {% if polls %}
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø³Ø¤Ø§Ù„</th>
                                <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ù…Ø¬Ù‡ÙˆÙ„</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for poll in polls %}
                            <tr>
                                <td>{{ poll.question }}</td>
                                <td>{{ poll.options|length }}</td>
                                <td>{{ poll.created_at|date:"Y-m-d" }}</td>
                                <td>{{ poll.is_anonymous|yesno:"Ù†Ø¹Ù…,Ù„Ø§" }}</td>
                                <td>
                                    <form method="post" style="display: inline;" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ØŸ')">
                                        {% csrf_token %}
                                        <input type="hidden" name="action" value="delete_poll">
                                        <input type="hidden" name="poll_id" value="{{ poll.id }}">
                                        <button type="submit" class="btn btn-danger" style="padding: 0.3rem 0.8rem; font-size: 0.8rem;">Ø­Ø°Ù</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                {% endif %}
            </div>
        </div>

        <!-- Gallery Tab -->
        <div id="gallery" class="tab-content">
            <div class="card">
                <h2>Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø¹Ø±Ø¶</h2>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="add_gallery">
                    
                    <div class="form-group">
                        <label for="gallery_title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù†ØµØ±</label>
                        <input type="text" id="gallery_title" name="gallery_title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="gallery_description">ÙˆØµÙ Ø§Ù„Ø¹Ù†ØµØ±</label>
                        <textarea id="gallery_description" name="gallery_description" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="gallery_media_type">Ù†ÙˆØ¹ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·</label>
                        <select id="gallery_media_type" name="gallery_media_type" onchange="toggleGalleryInputs()">
                            <option value="image">ØµÙˆØ±Ø©</option>
                            <option value="video">ÙÙŠØ¯ÙŠÙˆ</option>
                            <option value="external">Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ (ÙŠÙˆØªÙŠÙˆØ¨/Ù…Ù†Ø´ÙˆØ±)</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="gallery_file_group">
                        <label>Ù…Ù„Ù Ø§Ù„ÙˆØ³Ø§Ø¦Ø·</label>
                        <div class="file-input">
                            <input type="file" id="gallery_file" name="gallery_file" accept="image/*,video/*">
                            Ø§Ø®ØªØ± Ù…Ù„Ù ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ
                        </div>
                    </div>
                    
                    <div class="form-group" id="gallery_url_group" style="display:none;">
                        <label for="gallery_external_url">Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ (Ù…Ø«Ø§Ù„: https://youtu.be/â€¦ Ø£Ùˆ https://â€¦)</label>
                        <input type="url" id="gallery_external_url" name="gallery_external_url" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§">
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="gallery_is_featured" name="gallery_is_featured">
                            <label for="gallery_is_featured">Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="gallery_is_public" name="gallery_is_public" checked>
                            <label for="gallery_is_public">Ø¹Ø±Ø¶ Ù„Ù„Ø¹Ø§Ù…Ø©</label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success" onclick="return validateGalleryForm()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø¹Ø±Ø¶</button>
                </form>
            </div>

            <div class="card">
                <h2>Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                {% if gallery_items %}
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
                        {% for item in gallery_items %}
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; border: 1px solid #e9ecef;">
                            <div style="text-align: center; margin-bottom: 10px;">
                                {% if item.media_type == 'image' %}
                                    <img src="{{ item.file.url }}" alt="{{ item.title }}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px;">
                                {% elif item.media_type == 'video' %}
                                    <video controls style="width: 100%; height: 150px; border-radius: 8px;">
                                        <source src="{{ item.file.url }}" type="video/mp4">
                                        Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
                                    </video>
                                {% else %}
                                    {% if item.is_youtube and item.youtube_embed_id %}
                                        <iframe width="100%" height="150" src="https://www.youtube.com/embed/{{ item.youtube_embed_id }}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="border-radius:8px;"></iframe>
                                    {% else %}
                                        <a href="{{ item.external_url }}" target="_blank" style="display:inline-block; background:#eef2ff; color:#4f46e5; padding:10px 12px; border-radius:8px; text-decoration:none;">ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ</a>
                                    {% endif %}
                                {% endif %}
                            </div>
                            <h4 style="margin: 10px 0; color: #667eea;">{{ item.title }}</h4>
                            {% if item.description %}
                                <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">{{ item.description|truncatewords:15 }}</p>
                            {% endif %}
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span style="background: {% if item.media_type == 'image' %}#28a745{% elif item.media_type == 'video' %}#dc3545{% else %}#4f46e5{% endif %}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">{{ item.get_media_type_display }}</span>
                                {% if item.is_featured %}
                                    <span style="background: #ffc107; color: #333; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">Ù…Ù…ÙŠØ²</span>
                                {% endif %}
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <form method="post" style="flex: 1;" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ')">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="delete_gallery">
                                    <input type="hidden" name="gallery_id" value="{{ item.id }}">
                                    <button type="submit" class="btn btn-danger" style="width: 100%; padding: 5px; font-size: 0.8rem;">Ø­Ø°Ù</button>
                                </form>
                                {% if item.media_type == 'external' %}
                                    <a href="{{ item.external_url }}" target="_blank" class="btn btn-secondary" style="flex: 1; padding: 5px; font-size: 0.8rem; text-align: center;">ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·</a>
                                {% else %}
                                    <a href="{{ item.file.url }}" target="_blank" class="btn btn-secondary" style="flex: 1; padding: 5px; font-size: 0.8rem; text-align: center;">Ø¹Ø±Ø¶</a>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 2rem; color: #666;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ–¼ï¸</div>
                        <h3 style="color: #667eea; margin-bottom: 0.5rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ù…Ø¹Ø±Ø¶</h3>
                        <p>Ø£Ø¶Ù ØµÙˆØ± ÙˆÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¹Ù„Ù‰ ØµÙØ­ØªÙƒ Ø§Ù„Ø¹Ø§Ù…Ø©</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Benefits Tab -->
        <div id="benefits" class="tab-content">
            <div class="card">
                <h2>Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="add_benefit">
                    <div class="form-group">
                        <label for="benefit_title">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                        <input type="text" id="benefit_title" name="benefit_title" required>
                    </div>
                    <div class="form-group">
                        <label for="benefit_description">Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <textarea id="benefit_description" name="benefit_description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="benefit_icon">Ø§Ù„Ø±Ù…Ø² (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù…Ø«Ù„ ğŸš€)</label>
                        <input type="text" id="benefit_icon" name="benefit_icon" maxlength="8" placeholder="Ù…Ø«Ø§Ù„: ğŸš€">
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="benefit_is_public" name="benefit_is_public" checked>
                            <label for="benefit_is_public">Ø¹Ø±Ø¶ Ù„Ù„Ø¹Ø§Ù…Ø©</label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙŠØ²Ø©</button>
                </form>
            </div>

            <div class="card">
                <h2>Ø§Ù„Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                {% if benefits %}
                    <div style="overflow:auto;">
                        <table class="data-table" style="width:100%; min-width: 900px;">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ø±Ù…Ø²</th>
                                    <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                    <th>Ø§Ù„ÙˆØµÙ</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for b in benefits %}
                                <tr>
                                    <td>{% if b.icon %}{{ b.icon }}{% else %}-{% endif %}</td>
                                    <td style="font-weight:600;">{{ b.title }}</td>
                                    <td style="max-width:420px; white-space:normal;">{{ b.description|default:'â€”' }}</td>
                                    <td>
                                        <span style="padding:2px 8px; border-radius:12px; color:#fff; background:{% if b.is_public %}#22c55e{% else %}#6b7280{% endif %}; font-size:0.8rem;">
                                            {% if b.is_public %}Ù…Ù†Ø´ÙˆØ±{% else %}Ù…Ø®ÙÙŠ{% endif %}
                                        </span>
                                    </td>
                                    <td>
                                        <form method="post" style="display:flex; gap:6px; align-items:center;">
                                            {% csrf_token %}
                                            <input type="hidden" name="action" value="update_benefit_order">
                                            <input type="hidden" name="benefit_id" value="{{ b.id }}">
                                            <input type="number" name="display_order" value="{{ b.display_order }}" style="width:80px;">
                                            <button type="submit" class="btn">Ø­ÙØ¸</button>
                                        </form>
                                    </td>
                                    <td>
                                        <div style="display:flex; gap:6px;">
                                            <form method="post">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="toggle_benefit_visibility">
                                                <input type="hidden" name="benefit_id" value="{{ b.id }}">
                                                <button type="submit" class="btn" style="background:{% if b.is_public %}#6b7280{% else %}#22c55e{% endif %}; color:white;">
                                                    {% if b.is_public %}Ø¥Ø®ÙØ§Ø¡{% else %}Ù†Ø´Ø±{% endif %}
                                                </button>
                                            </form>
                                            <form method="post" onsubmit="return confirm('ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø©ØŸ')">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="delete_benefit">
                                                <input type="hidden" name="benefit_id" value="{{ b.id }}">
                                                <button type="submit" class="btn btn-danger">Ø­Ø°Ù</button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø²Ø§ÙŠØ§ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>
                {% endif %}
            </div>
        </div>

        <div id="testimonials" class="tab-content">
            <div class="card">
                <h2>Ø¥Ø¶Ø§ÙØ© Ø±Ø£ÙŠ Ø¯Ø§Ø¹Ù…</h2>
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="add_testimonial">
                    <div class="form-group">
                        <label for="t_name">Ø§Ù„Ø§Ø³Ù…</label>
                        <input type="text" id="t_name" name="t_name" required>
                    </div>
                    <div class="form-group">
                        <label for="t_role">Ø§Ù„ØµÙØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="text" id="t_role" name="t_role" placeholder="Ù…Ø«Ø§Ù„: Ù…ØªØ·ÙˆØ¹/Ù…Ø¤ÙŠØ¯/Ø¹Ø¶Ùˆ Ø¨Ø§Ù„Ø­Ù…Ù„Ø©">
                    </div>
                    <div class="form-group">
                        <label for="t_quote">Ø§Ù„Ø±Ø£ÙŠ</label>
                        <textarea id="t_quote" name="t_quote" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="t_is_public" name="t_is_public" checked>
                            <label for="t_is_public">Ø¹Ø±Ø¶ Ù„Ù„Ø¹Ø§Ù…Ø©</label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø£ÙŠ</button>
                </form>
            </div>

            <div class="card">
                <h2>Ø§Ù„Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
                {% if testimonials %}
                    <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
                        {% for t in testimonials %}
                        <div style="background:#f8f9fa; border-radius:10px; padding:14px; border:1px solid #e9ecef;">
                            <div style="font-weight:700; color:#1f2937;">{{ t.name }}</div>
                            {% if t.role %}<div style="color:#0ea5e9; font-size:0.85rem;">{{ t.role }}</div>{% endif %}
                            <div style="color:#64748b; margin-top:8px;">{{ t.quote }}</div>
                            <div style="display:flex; gap:6px; margin-top:10px;">
                                <form method="post" onsubmit="return confirm('ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ø£ÙŠØŸ')">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="delete_testimonial">
                                    <input type="hidden" name="testimonial_id" value="{{ t.id }}">
                                    <button type="submit" class="btn btn-danger">Ø­Ø°Ù</button>
                                </form>
                                <form method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="toggle_testimonial_visibility">
                                    <input type="hidden" name="testimonial_id" value="{{ t.id }}">
                                    <button type="submit" class="btn" style="background:{% if t.is_public %}#6b7280{% else %}#22c55e{% endif %}; color:white;">
                                        {% if t.is_public %}Ø¥Ø®ÙØ§Ø¡{% else %}Ù†Ø´Ø±{% endif %}
                                    </button>
                                </form>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¢Ø±Ø§Ø¡ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>
                {% endif %}
            </div>
        </div>

        <!-- Supporters Tab -->
        <div id="supporters" class="tab-content">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¤ÙŠØ¯ÙŠÙ†</h2>
                    {% if supporters %}
                        <button onclick="exportSupportersPDF()" class="btn" style="background: #dc3545; display: flex; align-items: center; gap: 8px;">
                            ğŸ“„ ØªØµØ¯ÙŠØ± PDF
                        </button>
                    {% endif %}
                </div>
                {% if supporters %}
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                                <th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¯Ø¹Ù…</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for supporter in supporters %}
                            <tr>
                                <td>
                                    {% if supporter.bot_user.first_name or supporter.bot_user.last_name %}
                                        {{ supporter.bot_user.first_name }} {{ supporter.bot_user.last_name }}
                                    {% else %}
                                        {{ supporter.bot_user.username|default:"-" }}
                                    {% endif %}
                                </td>
                                <td>
                                    {% if supporter.notes and "National ID:" in supporter.notes %}
                                        {{ supporter.notes|slice:"-14:" }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>{{ supporter.bot_user.phone_number|default:"-" }}</td>
                                <td>{{ supporter.city|default:"-" }}</td>
                                <td>
                                    {% if supporter.support_level == 1 %}
                                        <span style="color: #28a745; font-weight: bold;">{{ supporter.get_support_level_display }}</span>
                                    {% elif supporter.support_level == 2 %}
                                        <span style="color: #ffc107; font-weight: bold;">{{ supporter.get_support_level_display }}</span>
                                    {% elif supporter.support_level == 3 %}
                                        <span style="color: #dc3545; font-weight: bold;">{{ supporter.get_support_level_display }}</span>
                                    {% else %}
                                        <span style="color: #6c757d; font-weight: bold;">{{ supporter.get_support_level_display }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ supporter.registered_at|date:"Y-m-d" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div style="text-align: center; padding: 2rem; color: #666;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ‘¥</div>
                        <h3 style="color: #667eea; margin-bottom: 0.5rem;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¤ÙŠØ¯ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                        <p>Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù…Ø¤ÙŠØ¯ÙˆÙ† Ù‡Ù†Ø§ Ø¹Ù†Ø¯ Ù‚ÙŠØ§Ù… Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ø¨Ø¯Ø¹Ù…Ùƒ Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</p>
                        <!-- <a href="/hub/candidate/{{ candidate.id }}/" target="_blank" class="btn" style="margin-top: 1rem;">Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</a> -->
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        // Tab functionality
        function showTab(e, tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            if (e && e.currentTarget) {
                e.currentTarget.classList.add('active');
            }
        }

        // Poll options management
        function addOption() {
            const optionsList = document.getElementById('poll-options');
            const newOption = document.createElement('div');
            newOption.className = 'option-item';
            newOption.innerHTML = `
                <input type="text" name="poll_options" placeholder="Ø®ÙŠØ§Ø± Ø¬Ø¯ÙŠØ¯" required>
                <button type="button" class="remove-option-btn" onclick="removeOption(this)">Ø­Ø°Ù</button>
            `;
            optionsList.appendChild(newOption);
            updateRemoveButtons();
        }

        function removeOption(button) {
            button.parentElement.remove();
            updateRemoveButtons();
        }

        function updateRemoveButtons() {
            const options = document.querySelectorAll('.option-item');
            options.forEach((option, index) => {
                const removeBtn = option.querySelector('.remove-option-btn');
                if (options.length <= 2) {
                    removeBtn.style.display = 'none';
                } else {
                    removeBtn.style.display = 'block';
                }
            });
        }

        // File input handling
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up file inputs...');
            
            // Function to update file input display
            function updateFileInputDisplay(input, file) {
                const fileInputDiv = input.parentElement;
                const icon = input.name === 'profile_image' ? 'ğŸ“·' : 'ğŸ·ï¸';
                const label = fileInputDiv.querySelector('label');
                if (label) {
                    label.textContent = `${icon} ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${file.name}`;
                }
                console.log(`Updated display for ${input.name}: ${file.name}`);
            }
            
            // Setup file inputs
            const profileInput = document.getElementById('profile_image_input');
            const logoInput = document.getElementById('logo_input');
            
            if (profileInput) {
                console.log('Setting up profile image input');
                profileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        console.log('Profile image selected:', file.name, file.size, 'bytes');
                        updateFileInputDisplay(this, file);
                    }
                });
            } else {
                console.log('Profile image input not found!');
            }
            
            if (logoInput) {
                console.log('Setting up logo input');
                logoInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        console.log('Logo selected:', file.name, file.size, 'bytes');
                        updateFileInputDisplay(this, file);
                    }
                });
            } else {
                console.log('Logo input not found!');
            }

            // Form submission handling
            const profileForm = document.querySelector('form[method="post"]');
            if (profileForm) {
                profileForm.addEventListener('submit', function(e) {
                    console.log('Form submitting...');
                    const formData = new FormData(this);
                    console.log('Form data keys:', Array.from(formData.keys()));
                    
                    // Check if files are in form data
                    let hasFiles = false;
                    for (let [key, value] of formData.entries()) {
                        if (value instanceof File) {
                            console.log(`File found: ${key} - ${value.name} (${value.size} bytes)`);
                            hasFiles = true;
                        } else {
                            console.log(`Form field: ${key} = ${value}`);
                        }
                    }
                    
                    if (!hasFiles) {
                        console.log('WARNING: No files found in form data!');
                    }
                    
                    // Don't prevent default - let form submit normally
                    console.log('Form is submitting with', hasFiles ? 'files' : 'no files');
                });
            }
        });


        // Initialize remove buttons
        updateRemoveButtons();

        // Export supporters to PDF
        function exportSupportersPDF() {
            // Show loading state
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±...';
            btn.disabled = true;

            // Get supporters data
            const supporters = [
                {% for supporter in supporters %}
                {
                    name: `{% if supporter.bot_user.first_name or supporter.bot_user.last_name %}{{ supporter.bot_user.first_name }} {{ supporter.bot_user.last_name }}{% else %}{{ supporter.bot_user.username|default:"-" }}{% endif %}`,
                    nationalId: `{% if supporter.notes and "National ID:" in supporter.notes %}{{ supporter.notes|slice:"-14:" }}{% else %}-{% endif %}`,
                    phone: `{{ supporter.bot_user.phone_number|default:"-" }}`,
                    city: `{{ supporter.city|default:"-" }}`,
                    supportLevel: `{{ supporter.get_support_level_display }}`,
                    date: `{{ supporter.registered_at|date:"Y-m-d" }}`
                }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ];

            // Create PDF content
            let pdfContent = `
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¤ÙŠØ¯ÙŠÙ† - {{ candidate.name }}</title>
                    <style>
                        body {
                            font-family: 'Arial', sans-serif;
                            direction: rtl;
                            text-align: right;
                            margin: 20px;
                            color: #333;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #667eea;
                            padding-bottom: 20px;
                        }
                        .header h1 {
                            color: #667eea;
                            margin: 0;
                            font-size: 24px;
                        }
                        .header p {
                            color: #666;
                            margin: 5px 0;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 20px;
                            font-size: 12px;
                        }
                        th, td {
                            border: 1px solid #ddd;
                            padding: 8px;
                            text-align: right;
                        }
                        th {
                            background-color: #667eea;
                            color: white;
                            font-weight: bold;
                        }
                        tr:nth-child(even) {
                            background-color: #f9f9f9;
                        }
                        .footer {
                            margin-top: 30px;
                            text-align: center;
                            color: #666;
                            font-size: 10px;
                        }
                        .stats {
                            background-color: #f0f0f0;
                            padding: 15px;
                            border-radius: 5px;
                            margin-bottom: 20px;
                        }
                        .stats h3 {
                            margin: 0 0 10px 0;
                            color: #667eea;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¤ÙŠØ¯ÙŠÙ†</h1>
                        <p>Ø§Ù„Ù…Ø±Ø´Ø­: {{ candidate.name }}</p>
                        <p>Ø§Ù„Ù…Ù†ØµØ¨: {{ candidate.position }}</p>
                        <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµØ¯ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}</p>
                    </div>

                    <div class="stats">
                        <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¤ÙŠØ¯ÙŠÙ†</h3>
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¤ÙŠØ¯ÙŠÙ†: ${supporters.length}</p>
                        <p>Ù…Ø¤ÙŠØ¯ÙˆÙ†: ${supporters.filter(s => s.supportLevel.includes('Ù…Ø¤ÙŠØ¯')).length}</p>
                        <p>Ù…ØªØ·ÙˆØ¹ÙˆÙ†: ${supporters.filter(s => s.supportLevel.includes('Ù…ØªØ·ÙˆØ¹')).length}</p>
                        <p>Ø¯Ø§Ø¹Ù…ÙˆÙ† Ù…Ø§Ù„ÙŠÙˆÙ†: ${supporters.filter(s => s.supportLevel.includes('Ø¯Ø§Ø¹Ù… Ù…Ø§Ù„ÙŠ')).length}</p>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Ù…</th>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                                <th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¯Ø¹Ù…</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            supporters.forEach((supporter, index) => {
                pdfContent += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${supporter.name}</td>
                        <td>${supporter.nationalId}</td>
                        <td>${supporter.phone}</td>
                        <td>${supporter.city}</td>
                        <td>${supporter.supportLevel}</td>
                        <td>${supporter.date}</td>
                    </tr>
                `;
            });

            pdfContent += `
                        </tbody>
                    </table>

                    <div class="footer">
                        <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Election 360</p>
                        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© ${new Date().getFullYear()}</p>
                    </div>
                </body>
                </html>
            `;

            // Create and download PDF using browser's print functionality
            const printWindow = window.open('', '_blank');
            printWindow.document.write(pdfContent);
            printWindow.document.close();
            
            // Wait for content to load then trigger print
            setTimeout(() => {
                printWindow.focus();
                printWindow.print();
                
                // Reset button state
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 500);
        }
        // === Questions: modal and export ===
        function openQuestionModal(btn) {
            try {
                const tr = btn.closest('tr');
                if (!tr) return;
                const id = tr.getAttribute('data-q-id');
                const text = tr.getAttribute('data-q-text') || '';
                const name = tr.getAttribute('data-q-name') || '';
                const date = tr.getAttribute('data-q-date') || '';
                const answer = tr.getAttribute('data-q-answer') || '';
                const idEl = document.getElementById('qmId');
                const metaEl = document.getElementById('qmMeta');
                const textEl = document.getElementById('qmText');
                const answerEl = document.getElementById('qmAnswer');
                const modal = document.getElementById('questionModal');
                if (!idEl || !metaEl || !textEl || !answerEl || !modal) return;
                idEl.value = id;
                metaEl.textContent = `${name} â€¢ ${date}`;
                textEl.textContent = text;
                answerEl.value = answer;
                modal.style.display = 'block';
            } catch (e) { console.error('openQuestionModal error', e); }
        }

        function closeQuestionModal() {
            const modal = document.getElementById('questionModal');
            if (modal) modal.style.display = 'none';
        }

        // Edit modals helpers
        function openEditEventModal(id, title, desc, type, loc, start, end, is_public, max_att) {
            try {
                document.getElementById('ee_id').value = id;
                document.getElementById('ee_title').value = title || '';
                document.getElementById('ee_desc').value = desc || '';
                document.getElementById('ee_type').value = type || 'meeting';
                document.getElementById('ee_loc').value = loc || '';
                document.getElementById('ee_start').value = start || '';
                document.getElementById('ee_end').value = end || '';
                document.getElementById('ee_public').checked = (is_public === '1');
                document.getElementById('ee_max').value = max_att || '';
                document.getElementById('editEventModal').style.display = 'block';
            } catch (e) { console.error('openEditEventModal error', e); }
        }
        function closeEditEventModal() {
            const m = document.getElementById('editEventModal');
            if (m) m.style.display = 'none';
        }
        function openEditSpeechModal(id, title, content, summary) {
            try {
                document.getElementById('es_id').value = id;
                document.getElementById('es_title').value = title || '';
                document.getElementById('es_content').value = content || '';
                document.getElementById('es_summary').value = summary || '';
                document.getElementById('editSpeechModal').style.display = 'block';
            } catch (e) { console.error('openEditSpeechModal error', e); }
        }
        function closeEditSpeechModal() {
            const m = document.getElementById('editSpeechModal');
            if (m) m.style.display = 'none';
        }

        function submitQuestionAnswer(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            fetch(window.location.href, {
                method: 'POST',
                body: formData,
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            }).then(() => {
                closeQuestionModal();
                window.location.reload();
            }).catch(err => {
                console.error('submitQuestionAnswer error', err);
                closeQuestionModal();
            });
            return false;
        }

        function exportQuestionsPDF() {
            const table = document.querySelector('#questions .data-table');
            if (!table) { alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„Ù„ØªØµØ¯ÙŠØ±'); return; }
            const w = window.open('', '_blank');
            w.document.write(`
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="utf-8">
                    <title>Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± - {{ candidate.name }}</title>
                    <style>
                        body { font-family: Arial, sans-serif; direction: rtl; margin: 20px; color:#333; }
                        h1 { text-align:center; color:#667eea; }
                        table { width:100%; border-collapse: collapse; margin-top: 16px; font-size: 12px; }
                        th, td { border:1px solid #ddd; padding:8px; text-align:right; }
                        th { background:#f0f0f0; }
                    </style>
                </head>
                <body>
                    <h1>Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± - {{ candidate.name }}</h1>
                    ${table.outerHTML}
                </body>
                </html>
            `);
            w.document.close(); w.focus(); w.print(); w.close();
        }
        function toggleGalleryInputs() {
            var type = document.getElementById('gallery_media_type').value;
            var fileGroup = document.getElementById('gallery_file_group');
            var urlGroup = document.getElementById('gallery_url_group');
            var file = document.getElementById('gallery_file');
            var url = document.getElementById('gallery_external_url');
            if (type === 'external') {
                fileGroup.style.display = 'none';
                urlGroup.style.display = '';
                if (file) file.required = false;
                if (url) url.required = true;
            } else {
                fileGroup.style.display = '';
                urlGroup.style.display = 'none';
                if (file) file.required = true;
                if (url) url.required = false;
            }
        }

        function validateGalleryForm() {
            var type = document.getElementById('gallery_media_type').value;
            if (type === 'external') {
                var url = document.getElementById('gallery_external_url').value.trim();
                if (!url) { alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ.'); return false; }
            } else {
                var file = document.getElementById('gallery_file');
                if (!file || !file.files || !file.files.length) { alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©/Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.'); return false; }
            }
            return true;
        }
        document.addEventListener('DOMContentLoaded', toggleGalleryInputs);
    </script>
</body>
</html>